<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Backteroids!</title>
	<script type="text/javascript" src="phaser.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<script type="text/javascript" src="playLevel.js"></script>
	<script type="text/javascript" src="levelComplete.js"></script>
	<script type="text/javascript" src="splashScreen.js"></script>
	<script type="text/javascript" src="levelSelect.js"></script>
	<script type="text/javascript" src="buyUpgrades.js"></script>
	<script type="text/javascript" src="viewStats.js"></script>
	<script type="text/javascript" src="viewAchievements.js"></script>
	<script type="text/javascript" src="beastiary.js"></script>
	<script type="text/javascript" src="credits.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>

<script type="text/javascript">

	var gameWidth = 800;
	var gameHeight = 600;

	var game = new Phaser.Game(gameWidth, gameHeight, Phaser.AUTO);
	game.state.add("PlayLevel",playLevel);
	game.state.add("LevelComplete",levelComplete);
	game.state.add("SplashScreen",splashScreen);
	game.state.add("LevelSelect",levelSelect);
	game.state.add("BuyUpgrades",buyUpgrades);
	game.state.add("ViewStats",viewStats);
	game.state.add("ViewAchievements",viewAchievements);
	game.state.add("Beastiary",beastiary);
	game.state.add("Credits",credits);
	game.state.start("SplashScreen");

	var playerData = {};
	playerData.levelScores = {};
	playerData.totalScore = 0;
	playerData.level = 1;
	var menuMusic = null;

	var calculateTotalScore = function() {
		var totalScore = 0;
		$.each(playerData.levelScores,function(index,levelScore){
			totalScore = totalScore + levelScore.bestScore;
		});
		playerData.totalScore = totalScore;
	};

	var displayTotalScore = function() {
		calculateTotalScore();
		var graphics = game.add.graphics(0, 0);
		graphics.lineStyle(2, 0x888888, 1);
		graphics.beginFill(0x444444, 1);
    	graphics.drawRect(0,0,gameWidth,26);

		var scoreTextStyle = {font: "bold 16px Arial", fill: "#ffff00"};
		var scoreText = game.add.text(20,5,"Total Score: "+playerData.totalScore,scoreTextStyle);
		scoreText.anchor.x = 0;
		scoreText.anchor.y = 0;
	};

	var calculatePlayerLevel = function(gameData) {
		levels = gameData.levelThresholds;
		var tempLevel = 1;
		for (var i =1; i<levels.length-1; i++)
		{
			tempLevel = tempLevel + Math.max(0,Math.min(1,(playerData.totalScore-levels[i-1]) / (levels[i]-levels[i-1])));
		}
		playerData.level = Math.floor(tempLevel);
		return tempLevel;
	}

	var displayPlayerLevel = function() {
		var playerLevelTextStyle = {font: "bold 16px Arial", fill: "#ffff00"};
		var playerLevelText = game.add.text(550,5,"Lv. "+playerData.level,playerLevelTextStyle);
		playerLevelText.anchor.x = 1;
		playerLevelText.anchor.y = 0;

		pctFull = calculatePlayerLevel(gameData) - playerData.level;

		var graphics = game.add.graphics(0, 0);
		graphics.lineStyle(1, 0xCCCCCCC, 1);
		graphics.beginFill(0x000000, 1);
    	graphics.drawRect(560,5,230,16);

    	graphics.lineStyle(0, 0x000000, 1);
    	graphics.beginFill(0x00CC00,1);
    	graphics.drawRect(561,6,228*pctFull,15);

	}

	var loadShipSprites = function() {
		game.load.spritesheet('ship_e1','res/ship_e1.png',30,30);
		game.load.spritesheet('ship_e2','res/ship_e2.png',30,30);
		game.load.spritesheet('ship_e3','res/ship_e3.png',30,30);
		game.load.spritesheet('ship_e4','res/ship_e4.png',30,30);
		game.load.spritesheet('ship_e5','res/ship_e5.png',30,30);
		game.load.spritesheet('ship_e6','res/ship_e6.png',30,30);
		game.load.spritesheet('ship_e7','res/ship_e7.png',30,30);
		game.load.spritesheet('ship_c1','res/ship_c1.png',40,40);
		game.load.spritesheet('ship_c2','res/ship_c2.png',40,40);
		game.load.spritesheet('ship_c3','res/ship_c3.png',40,40);
		game.load.spritesheet('ship_c4','res/ship_c4.png',40,40);
		game.load.spritesheet('ship_c5','res/ship_c5.png',40,40);
		game.load.spritesheet('ship_c6','res/ship_c6.png',40,40);
		game.load.spritesheet('ship_c7','res/ship_c7.png',40,40);
	};

	var preLoadButtons = function() {
		game.load.spritesheet('button_blank','res/button_blank.png',110,35);
	}

	var preLoadSounds = function() {
		game.load.audio('menu_music',['res/sounds/menu_music.ogg','res/sounds/menu_music.mp3']);
		game.load.audio('battle_explosion',['res/sounds/battle_explosion.ogg','res/sounds/battle_explosion.mp3']);
	}

	var loadSounds = function() {
		if (menuMusic === null)
		{
			menuMusic = game.add.audio('menu_music');
			menuMusic.onDecoded.add(startMusic,this);
		}
	}

	var startMusic = function() {
		menuMusic.fadeIn(2000,true);
	}

	var createNavigationButtons = function(currentFrame)
	{
		drawNavButton("LevelSelect","Select Level",20,"bold 14px Arial",currentFrame);
		drawNavButton("BuyUpgrades","Upgrades",150,"bold 16px Arial",currentFrame);
		drawNavButton("ViewStats","Statistics",280,"bold 16px Arial",currentFrame);
		drawNavButton("ViewAchievements","Achievements",410,"bold 15px Arial",currentFrame);
		drawNavButton("Beastiary","Beastiary",540,"bold 16px Arial",currentFrame);
		drawNavButton("Credits","Credits",670,"bold 16px Arial",currentFrame);
	}

	var drawNavButton = function(key,text,x,font,currentFrame)
	{
		if (key!==currentFrame)
		{
			var navButton = this.game.add.button(x,550,"button_blank",clickNavButton,this,1,0,1,0);
			navButton.stateKey = key;	
		}
		else
		{
			var currentButton = this.game.add.sprite(x,550,"button_blank");
			currentButton.frame = 2;
		}
		var buttonText = game.add.text(x+55,569,text,{font:font, fill: "#ffffff"});
		buttonText.anchor.x = 0.5;
		buttonText.anchor.y = 0.5;
	}

	var clickNavButton = function(navButton)
	{
		game.state.start(navButton.stateKey);
	}


</script>


</head>
<body>

<h1> Backteroids </h1>



<p> By Ryan Schulz </p>

</body>
</html>